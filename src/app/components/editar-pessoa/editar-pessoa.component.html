<div class="container">
  <!-- Header Section -->
  <div class="header-section animate-fade-in-up">
    <div class="breadcrumb">
      <a routerLink="/" class="breadcrumb-item">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Pessoas
      </a>
      <span class="breadcrumb-separator">/</span>
      <span class="breadcrumb-current">Editar Pessoa</span>
    </div>
    
    <div class="page-header">
      <div class="page-title-section">
        <div class="page-icon">
          <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="m18.5 2.5 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="page-title-text">
          <h1 class="page-title">Editar Pessoa</h1>
          <p class="page-subtitle" *ngIf="pessoa">Editando dados de {{ pessoa.nome }}</p>
          <p class="page-subtitle" *ngIf="loading">Carregando dados da pessoa...</p>
        </div>
      </div>

      <!-- Person Avatar -->
      <div class="person-avatar" *ngIf="pessoa && !loading">
        <div class="avatar-circle">
          <span>{{ getInitials(pessoa.nome) }}</span>
        </div>
        <div class="avatar-info">
          <h3 class="avatar-name">{{ pessoa.nome }}</h3>
          <p class="avatar-detail">{{ formatarCpfDisplay(pessoa.cpf) }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-section animate-fade-in-up" *ngIf="loading">
    <div class="loading-card">
      <div class="loading-spinner-large"></div>
      <h3>Carregando dados...</h3>
      <p>Por favor, aguarde enquanto carregamos as informações da pessoa.</p>
    </div>
  </div>

  <!-- Form Section -->
  <div class="form-section animate-slide-in-right" *ngIf="!loading && pessoa">
    <div class="form-card">
      <form [formGroup]="pessoaForm" (ngSubmit)="onSubmit()">
        
        <!-- Personal Info Section -->
        <div class="form-section-header">
          <div class="section-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div>
            <h3 class="section-title">Informações Pessoais</h3>
            <p class="section-subtitle">Atualize os dados conforme necessário</p>
          </div>
        </div>

        <div class="form-grid">
          <!-- Nome -->
          <div class="form-group full-width">
            <label for="nome" class="form-label">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Nome Completo *
            </label>
            <input 
              type="text" 
              id="nome" 
              formControlName="nome" 
              class="form-control"
              [class.error]="isFieldInvalid('nome')"
              placeholder="Digite o nome completo"
              autocomplete="name"
            />
            <div class="error-message" *ngIf="getFieldError('nome')">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              {{ getFieldError('nome') }}
            </div>
          </div>

          <!-- CPF -->
          <div class="form-group">
            <label for="cpf" class="form-label">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="2" y="3" width="20" height="14" rx="2" ry="2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="8" y1="21" x2="16" y2="21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="12" y1="17" x2="12" y2="21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              CPF *
            </label>
            <input 
              type="text" 
              id="cpf" 
              class="form-control"
              [class.error]="isFieldInvalid('cpf')"
              placeholder="000.000.000-00"
              maxlength="14"
              (input)="formatarCpf($event)"
              autocomplete="off"
            />
            <div class="error-message" *ngIf="getFieldError('cpf')">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              {{ getFieldError('cpf') }}
            </div>
          </div>

          <!-- Telefone -->
          <div class="form-group">
            <label for="telefone" class="form-label">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Telefone *
            </label>
            <input 
              type="text" 
              id="telefone" 
              class="form-control"
              [class.error]="isFieldInvalid('telefone')"
              placeholder="(00) 00000-0000"
              maxlength="15"
              (input)="formatarTelefone($event)"
              autocomplete="tel"
            />
            <div class="error-message" *ngIf="getFieldError('telefone')">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              {{ getFieldError('telefone') }}
            </div>
          </div>

          <!-- Data de Nascimento -->
          <div class="form-group">
            <label for="dataNascimento" class="form-label">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Data de Nascimento *
            </label>
            <input 
              type="date" 
              id="dataNascimento" 
              formControlName="dataNascimento" 
              class="form-control"
              [class.error]="isFieldInvalid('dataNascimento')"
              autocomplete="bday"
            />
            <div class="error-message" *ngIf="getFieldError('dataNascimento')">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              {{ getFieldError('dataNascimento') }}
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="form-actions">
          <div class="primary-actions">
            <button 
              type="button" 
              class="btn btn-secondary"
              routerLink="/"
              [disabled]="saving || deleting">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="m12 19-7-7 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M19 12H5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Voltar
            </button>

            <button 
              type="submit" 
              class="btn btn-primary btn-lg"
              [disabled]="pessoaForm.invalid || saving || deleting">
              <div class="loading-spinner" *ngIf="saving"></div>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" *ngIf="!saving">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <polyline points="17,21 17,13 7,13 7,21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <polyline points="7,3 7,8 15,8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              {{ saving ? 'Salvando...' : 'Salvar Alterações' }}
            </button>
          </div>

          <div class="danger-actions">
            <button 
              type="button" 
              class="btn btn-danger"
              (click)="confirmarExclusao()"
              [disabled]="saving || deleting">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <polyline points="3,6 5,6 21,6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="m19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="10" y1="11" x2="10" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="14" y1="11" x2="14" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Excluir Pessoa
            </button>
          </div>
        </div>

      </form>
    </div>

    <!-- Warning Card -->
    <div class="warning-card">
      <div class="warning-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 9v4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="m12 17.02.01-.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="warning-content">
        <h4 class="warning-title">Atenção</h4>
        <ul class="warning-list">
          <li>Verifique os dados antes de salvar</li>
          <li>A exclusão da pessoa é irreversível</li>
          <li>CPF deve ser único no sistema</li>
          <li>Campos obrigatórios estão marcados com *</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Confirmação de Exclusão -->
<div class="modal animate-fade-in-up" *ngIf="showDeleteModal" (click)="fecharModalBackdrop($event)">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="modal-icon danger">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 9v4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="m12 17.02.01-.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <h3 class="modal-title">Confirmar Exclusão</h3>
    </div>
    
    <div class="modal-body">
      <p class="modal-text">
        Tem certeza que deseja excluir <strong>{{ pessoa?.nome }}</strong>?
      </p>
      <div class="person-preview" *ngIf="pessoa">
        <div class="preview-avatar">
          <span>{{ getInitials(pessoa.nome) }}</span>
        </div>
        <div class="preview-info">
          <h4>{{ pessoa.nome }}</h4>
          <p>{{ formatarCpfDisplay(pessoa.cpf) }}</p>
          <p>{{ formatarTelefoneDisplay(pessoa.telefone) }}</p>
        </div>
      </div>
      <p class="modal-warning">
        <strong>Esta ação não pode ser desfeita!</strong> Todos os dados da pessoa serão permanentemente removidos do sistema.
      </p>
    </div>
    
    <div class="modal-actions">
      <button 
        class="btn btn-secondary"
        (click)="fecharModal()"
        [disabled]="deleting">
        Cancelar
      </button>
      <button 
        class="btn btn-danger"
        (click)="excluirPessoa()"
        [disabled]="deleting">
        <div class="loading-spinner" *ngIf="deleting"></div>
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" *ngIf="!deleting">
          <polyline points="3,6 5,6 21,6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="m19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        {{ deleting ? 'Excluindo...' : 'Sim, Excluir' }}
      </button>
    </div>
  </div>
</div>